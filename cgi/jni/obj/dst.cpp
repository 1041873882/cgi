#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "cgivars.h"
#include "eHttp.h"
#include "dmsg.h"

void process(char **getvars, char **postvars, int form_method)
{
 print_html_header(); 
    dmsg req;
    dxml p;

    req.request("/ui/web/dst/read", NULL);
    p.load(req.body());

    if(form_method == POST) {
        int x = eGetInt("start_t");
        int y = eGetInt("end_t");

        p.setInt("/params/dst/enable", eGetInt("enable"));
        p.setInt("/params/dst/bias", eGetInt("bias"));
        p.setInt("/params/dst/start_m", eGetInt("start_m"));
        p.setInt("/params/dst/start_w", eGetInt("start_w"));
        p.setInt("/params/dst/start_d", eGetInt("start_d"));
        p.setInt("/params/dst/end_m", eGetInt("end_m"));
        p.setInt("/params/dst/end_w", eGetInt("end_w"));
        p.setInt("/params/dst/end_d", eGetInt("end_d"));

        if (x > 0 && x < 24 && y > 0 && y < 24) {
            p.setInt("/params/dst/start_t", x);
            p.setInt("/params/dst/end_t", y);
        }
        

        req.request("/ui/web/dst/write", p.data());     
    }
printf("    \n");
printf("<html>\n");
printf("\n");
printf("<head>\n");
printf("<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\n");
printf("<link href=\"/css/style.css\" rel=\"stylesheet\" type=\"text/css\">\n");
printf("<style>\n");
printf("    a:link,a:visited\n");
printf("    {\n");
printf("        display:block;\n");
printf("        font-weight:bold;\n");
printf("        color:#FFFFFF;\n");
printf("        background-color:#98bf21;\n");
printf("        width:120px;\n");
printf("        text-align:center;\n");
printf("        padding:4px;\n");
printf("        text-decoration:none;\n");
printf("    }\n");
printf("    a:hover,a:active\n");
printf("    {\n");
printf("        background-color:#000000;\n");
printf("    }\n");
printf("    </style>\n");
printf("</head>\n");
printf("\n");
printf("\n");
printf("\n");
printf("<body>\n");
printf("<form method=\"post\" action=\"dst.cgi\">\n");
printf("    <table width=\"90%%\" border=\"0\" id=\"table1\">\n");
printf("        <tr>\n");
printf("            <td class=\"header\"><strong>");
 ePrint(ehttp_xml.get("/dnake/dst/title")); printf("</strong></td>\n");
printf("        </tr>\n");
printf("        <tr>\n");
printf("            <td><hr></td>       \n");
printf("        </tr>\n");
printf("        <tr>\n");
printf("            <table border=\"0\" id=\"table2\">\n");
printf("                <tr>            \n");
printf("                    <td><a href=\"/cgi-bin/time.cgi\" target=\"main\" >Time</a></td>\n");
printf("                    <td><a href=\"/cgi-bin/dst.cgi\" target=\"main\" >DST</a></td>\n");
printf("                </tr>\n");
printf("                <tr>\n");
printf("					<td>&nbsp;</td>\n");
printf("                </tr>\n");
printf("                <tr>\n");
printf("					<td width=\"96\">");
 ePrint(ehttp_xml.get("/dnake/dst/enable")); printf("</td>\n");
printf("					<td>\n");
printf("                        <input type=\"radio\" name=\"enable\" value=\"1\" id=\"on\" ");
 if(p.getInt("/params/dst/enable", 0) == 1) printf("checked"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/on")); printf("\n");
printf("                        <input type=\"radio\" name=\"enable\" value=\"0\" id=\"off\" ");
 if(p.getInt("/params/dst/enable", 0) == 0) printf("checked"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/off")); printf("\n");
printf("                    </td>\n");
printf("                </tr>           \n");
printf("                <tr>\n");
printf("                    <td>&nbsp;</td>\n");
printf("                    <td>&nbsp;</td>\n");
printf("                </tr>\n");
printf("                <tr>\n");
printf("                    <td width=\"96\">");
 ePrint(ehttp_xml.get("/dnake/dst/start")); printf("</td>\n");
printf("                    <td>\n");
printf("                        <select name=\"start_m\" style=\"width:80px;\">\n");
printf("                            <option value=\"1\" ");
 if(strcmp(p.getText("/params/dst/start_m"), "0") == 1) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_1")); printf("</option>\n");
printf("                            <option value=\"2\" ");
 if(strcmp(p.getText("/params/dst/start_m"), "0") == 2) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_2")); printf("</option>\n");
printf("                            <option value=\"3\" ");
 if(strcmp(p.getText("/params/dst/start_m"), "0") == 3) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_3")); printf("</option>\n");
printf("                            <option value=\"4\" ");
 if(strcmp(p.getText("/params/dst/start_m"), "0") == 4) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_4")); printf("</option>\n");
printf("                            <option value=\"5\" ");
 if(strcmp(p.getText("/params/dst/start_m"), "0") == 5) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_5")); printf("</option>\n");
printf("                            <option value=\"6\" ");
 if(strcmp(p.getText("/params/dst/start_m"), "0") == 6) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_6")); printf("</option>\n");
printf("                            <option value=\"7\" ");
 if(strcmp(p.getText("/params/dst/start_m"), "0") == 7) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_7")); printf("</option>\n");
printf("                            <option value=\"8\" ");
 if(strcmp(p.getText("/params/dst/start_m"), "0") == 8) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_8")); printf("</option>\n");
printf("                            <option value=\"9\" ");
 if(strcmp(p.getText("/params/dst/start_m"), "0") == 9) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_9")); printf("</option>\n");
printf("                            <option value=\"10\" ");
 if(strcmp(p.getText("/params/dst/start_m"), "0") == 10) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_10")); printf("</option>\n");
printf("                            <option value=\"11\" ");
 if(strcmp(p.getText("/params/dst/start_m"), "0") == 11) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_11")); printf("</option>\n");
printf("                            <option value=\"12\" ");
 if(strcmp(p.getText("/params/dst/start_m"), "0") == 12) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_12")); printf("</option>\n");
printf("                        </select>\n");
printf("                        <select name=\"start_w\" style=\"width:80px;\">\n");
printf("                            <option value=\"1\" ");
 if(strcmp(p.getText("/params/dst/start_w"), "0") == 1) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/week_1")); printf("</option>\n");
printf("                            <option value=\"2\" ");
 if(strcmp(p.getText("/params/dst/start_w"), "0") == 2) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/week_2")); printf("</option>\n");
printf("                            <option value=\"3\" ");
 if(strcmp(p.getText("/params/dst/start_w"), "0") == 3) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/week_3")); printf("</option>\n");
printf("                            <option value=\"4\" ");
 if(strcmp(p.getText("/params/dst/start_w"), "0") == 4) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/week_4")); printf("</option>\n");
printf("                            <option value=\"5\" ");
 if(strcmp(p.getText("/params/dst/start_w"), "0") == 5) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/week_5")); printf("</option>\n");
printf("                        </select>\n");
printf("                        <select name=\"start_d\" style=\"width:80px;\">\n");
printf("                            <option value=\"0\" ");
 if(strcmp(p.getText("/params/dst/start_d"), "0") == 0) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/date_1")); printf("</option>\n");
printf("                            <option value=\"1\" ");
 if(strcmp(p.getText("/params/dst/start_d"), "0") == 1) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/date_2")); printf("</option>\n");
printf("                            <option value=\"2\" ");
 if(strcmp(p.getText("/params/dst/start_d"), "0") == 2) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/date_3")); printf("</option>\n");
printf("                            <option value=\"3\" ");
 if(strcmp(p.getText("/params/dst/start_d"), "0") == 3) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/date_4")); printf("</option>\n");
printf("                            <option value=\"4\" ");
 if(strcmp(p.getText("/params/dst/start_d"), "0") == 4) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/date_5")); printf("</option>\n");
printf("                            <option value=\"5\" ");
 if(strcmp(p.getText("/params/dst/start_d"), "0") == 5) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/date_6")); printf("</option>\n");
printf("                            <option value=\"6\" ");
 if(strcmp(p.getText("/params/dst/start_d"), "0") == 6) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/date_7")); printf("</option>\n");
printf("                            \n");
printf("                        </select>\n");
printf("                    </td>\n");
printf("                    <td>\n");
printf("                        <input  type=\"text\" style=\"width:80px;\" name=\"start_t\" value=\"");
 ePrint(p.getText("/params/dst/start_t")); printf("\", id=\"start_t\"></td>\n");
printf("                    <td>\n");
printf("                    <td>h<td>\n");
printf("                </tr>\n");
printf("                <tr>\n");
printf("                    <td width=\"96\">");
 ePrint(ehttp_xml.get("/dnake/dst/end")); printf("</td>\n");
printf("                    <td>\n");
printf("                        <select name=\"end_m\" style=\"width:80px;\">\n");
printf("                            <option value=\"1\" ");
 if(strcmp(p.getText("/params/dst/end_m"), "0") == 1) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_1")); printf("</option>\n");
printf("                            <option value=\"2\" ");
 if(strcmp(p.getText("/params/dst/end_m"), "0") == 2) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_2")); printf("</option>\n");
printf("                            <option value=\"3\" ");
 if(strcmp(p.getText("/params/dst/end_m"), "0") == 3) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_3")); printf("</option>\n");
printf("                            <option value=\"4\" ");
 if(strcmp(p.getText("/params/dst/end_m"), "0") == 4) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_4")); printf("</option>\n");
printf("                            <option value=\"5\" ");
 if(strcmp(p.getText("/params/dst/end_m"), "0") == 5) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_5")); printf("</option>\n");
printf("                            <option value=\"6\" ");
 if(strcmp(p.getText("/params/dst/end_m"), "0") == 6) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_6")); printf("</option>\n");
printf("                            <option value=\"7\" ");
 if(strcmp(p.getText("/params/dst/end_m"), "0") == 7) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_7")); printf("</option>\n");
printf("                            <option value=\"8\" ");
 if(strcmp(p.getText("/params/dst/start_m"), "0") == 8) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_8")); printf("</option>\n");
printf("                            <option value=\"9\" ");
 if(strcmp(p.getText("/params/dst/start_m"), "0") == 9) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_9")); printf("</option>\n");
printf("                            <option value=\"10\" ");
 if(strcmp(p.getText("/params/dst/start_m"), "0") == 10) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_10")); printf("</option>\n");
printf("                            <option value=\"11\" ");
 if(strcmp(p.getText("/params/dst/start_m"), "0") == 11) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_11")); printf("</option>\n");
printf("                            <option value=\"12\" ");
 if(strcmp(p.getText("/params/dst/start_m"), "0") == 12) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/mon_12")); printf("</option>\n");
printf("                        </select>\n");
printf("                        <select name=\"end_w\" style=\"width:80px;\">\n");
printf("                            <option value=\"1\" ");
 if(strcmp(p.getText("/params/dst/end_w"), "0") == 1) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/week_1")); printf("</option>\n");
printf("                            <option value=\"2\" ");
 if(strcmp(p.getText("/params/dst/end_w"), "0") == 2) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/week_2")); printf("</option>\n");
printf("                            <option value=\"3\" ");
 if(strcmp(p.getText("/params/dst/end_w"), "0") == 3) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/week_3")); printf("</option>\n");
printf("                            <option value=\"4\" ");
 if(strcmp(p.getText("/params/dst/end_w"), "0") == 4) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/week_4")); printf("</option>\n");
printf("                            <option value=\"5\" ");
 if(strcmp(p.getText("/params/dst/end_w"), "0") == 5) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/week_5")); printf("</option>\n");
printf("                        </select>\n");
printf("                        <select name=\"end_d\" style=\"width:80px;\">\n");
printf("                            <option value=\"0\" ");
 if(strcmp(p.getText("/params/dst/end_d"), "0") == 0) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/date_1")); printf("</option>\n");
printf("                            <option value=\"1\" ");
 if(strcmp(p.getText("/params/dst/end_d"), "0") == 1) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/date_2")); printf("</option>\n");
printf("                            <option value=\"2\" ");
 if(strcmp(p.getText("/params/dst/end_d"), "0") == 2) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/date_3")); printf("</option>\n");
printf("                            <option value=\"3\" ");
 if(strcmp(p.getText("/params/dst/end_d"), "0") == 3) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/date_4")); printf("</option>\n");
printf("                            <option value=\"4\" ");
 if(strcmp(p.getText("/params/dst/end_d"), "0") == 4) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/date_5")); printf("</option>\n");
printf("                            <option value=\"5\" ");
 if(strcmp(p.getText("/params/dst/end_d"), "0") == 5) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/date_6")); printf("</option>\n");
printf("                            <option value=\"6\" ");
 if(strcmp(p.getText("/params/dst/end_d"), "0") == 6) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/date_7")); printf("</option>\n");
printf("                        </select>\n");
printf("                    </td>\n");
printf("                    <td>\n");
printf("                        <input  type=\"text\" style=\"width:80px;\" name=\"end_t\" value=\"");
 ePrint(p.getText("/params/dst/end_t")); printf("\", id=\"end_m\"></td>\n");
printf("                    <td>\n");
printf("                    <td>h<td>\n");
printf("                </tr>\n");
printf("                <tr>\n");
printf("                    <td width=\"96\">");
 ePrint(ehttp_xml.get("/dnake/dst/bias")); printf("</td>\n");
printf("                    <td>\n");
printf("                        <select name=\"bias\" style=\"width:240px;\">\n");
printf("                            <option value=\"30\" ");
 if(strcmp(p.getText("/params/dst/bias"), "0") == 30) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/bias_1")); printf("</option>\n");
printf("                            <option value=\"60\" ");
 if(strcmp(p.getText("/params/dst/bias"), "0") == 60) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/bias_2")); printf("</option>\n");
printf("                            <option value=\"90\" ");
 if(strcmp(p.getText("/params/dst/bias"), "0") == 90) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/bias_3")); printf("</option>\n");
printf("                            <option value=\"120\" ");
 if(strcmp(p.getText("/params/dst/bias"), "0") == 120) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/bias_4")); printf("</option>\n");
printf("                            <option value=\"150\" ");
 if(strcmp(p.getText("/params/dst/bias"), "0") == 150) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/bias_5")); printf("</option>\n");
printf("                            <option value=\"180\" ");
 if(strcmp(p.getText("/params/dst/bias"), "0") == 180) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/bias_6")); printf("</option>\n");
printf("                            <option value=\"210\" ");
 if(strcmp(p.getText("/params/dst/bias"), "0") == 210) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/bias_7")); printf("</option>\n");
printf("                            <option value=\"240\" ");
 if(strcmp(p.getText("/params/dst/bias"), "0") == 240) ePrint("selected"); printf(">");
 ePrint(ehttp_xml.get("/dnake/dst/bias_8")); printf("</option>\n");
printf("                        </select>                        \n");
printf("                    </td>\n");
printf("                </tr>  \n");
printf("                </table>\n");
printf("            </td>\n");
printf("        </tr>\n");
printf("        <tr>\n");
printf("            <td><hr></td>\n");
printf("        </tr>\n");
printf("        <tr>\n");
printf("            <td>\n");
printf("            <input type=\"submit\" value=\"");
 ePrint(ehttp_xml.get("/dnake/submit")); printf("\"></td>\n");
printf("        </tr>\n");
printf("    </table>\n");
printf("</form>\n");
printf("\n");
printf("</body>\n");
printf("</html>\n");
printf("    ");
}

