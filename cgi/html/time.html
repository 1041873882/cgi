
<% print_html_header(); %>
<%
    dmsg req;
    dxml p;

    req.request("/ui/web/time/read", NULL);
    p.load(req.body());


    if(form_method == POST) {

        char hour[12];
        int ntp;
        ntp = eGetInt("ntp");

        p.setInt("/params/ntp/enable", ntp);
        if (!ntp) {
            strcpy(hour, eGetText("hour"));
            if (hour != NULL && atoi(hour) > 0 && atoi(hour) < 24) {
                p.setText("/params/settime/hour", hour);
            } 
        } 
        req.request("/ui/web/time/write", p.data());       
    }
%>
    
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="/css/style.css" rel="stylesheet" type="text/css">

</head>

<script>
    function on_sync_button()
    {
        var d = new Date();
        var h = String(d.getHours());
        var m = String(d.getMinutes());
        var s = String(d.getSeconds());
        document.getElementById("text").value = h+":"+m+":"+s;
    }
</script>


<body>
<form method="post" action="time.cgi">
    <table width="90%" border="0" id="table1">
        <tr>
            <td class="header"><strong><% ePrint(ehttp_xml.get("/dnake/time/title")); %></strong></td>
        </tr>
        <tr>
            <td><hr></td>
        </tr>
        <tr>
            <td>
            <table border="0" id="table2">
				<tr>
					<td width="96"><% ePrint(ehttp_xml.get("/dnake/time/ntp")); %></td>
					<td><input type="checkbox" name="ntp" value="1" <% if (p.getInt("/params/ntp/enable", 0)) ePrint("checked"); %>/></td>
				</tr>
				<tr>
					<td>&nbsp;</td>
					<td>&nbsp;</td>
				</tr>
                <tr>
                    <td width="96"><% ePrint(ehttp_xml.get("/dnake/time/hour")); %></td>
                    <td>
                    <input  type="text" style="width:160px;" name="hour" value="<% ePrint(p.getText("/params/settime/hour")); %>", id="text"></td>
                    <td>
                    <input type="button" value="<% ePrint(ehttp_xml.get("/dnake/sync_time")); %>" onClick="on_sync_button()"></td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td><hr></td>
        </tr>
        <tr>
            <td>
            <input type="submit" value="<% ePrint(ehttp_xml.get("/dnake/submit")); %>"></td>
        </tr>
    </table>
</form>

</body>
</html>
    